<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CAISO RegIntel Dashboard ‚Äî Alvarez & Marsal</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Segoe UI',Arial,sans-serif;background:#F0F4F9;min-height:100vh}
button{font-family:inherit;cursor:pointer}
table{border-collapse:collapse;width:100%}
th,td{text-align:left;padding:7px 10px;font-size:12px}
thead tr{background:#1F3864;color:white}
tbody tr:nth-child(even){background:#F4F6F9}
.header{background:#1F3864;color:white;padding:14px 28px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 3px 12px rgba(0,0,0,.25)}
.header-title{font-size:18px;font-weight:800;letter-spacing:.02em}
.header-sub{font-size:11px;color:#94B3D0;margin-top:2px}
.header-badges{display:flex;gap:8px;align-items:center}
.badge-blue{font-size:11px;background:#2E5FA3;padding:3px 10px;border-radius:20px;font-weight:600}
.badge-green{font-size:11px;background:#27AE60;color:white;padding:3px 10px;border-radius:20px;font-weight:700}
.tabs{background:white;border-bottom:2px solid #E5E7EB;display:flex;padding-left:16px;overflow-x:auto}
.tab{padding:12px 18px;border:none;background:transparent;font-size:13px;font-weight:700;color:#6B7280;border-bottom:3px solid transparent;transition:all .15s;white-space:nowrap}
.tab.active{color:#2E75B6;border-bottom:3px solid #2E75B6}
.content{padding:20px 24px;max-width:1400px;margin:0 auto}
.page{display:none}.page.active{display:block}
.page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.page-title{font-size:17px;font-weight:800;color:#1F3864}
.page-source{font-size:11px;color:#6B7280}
.kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:18px}
.kpi{background:white;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.08);padding:14px 18px;border-left:4px solid #2E75B6}
.kpi-label{font-size:11px;color:#6B7280;font-weight:600;text-transform:uppercase;letter-spacing:.05em}
.kpi-value{font-size:26px;font-weight:800;margin-top:2px}
.kpi-sub{font-size:11px;color:#6B7280;margin-top:2px}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:18px}
.grid-2-wide{display:grid;grid-template-columns:1.4fr 1fr;gap:16px;margin-bottom:18px}
.grid-2-wide2{display:grid;grid-template-columns:1.2fr 1fr;gap:16px;margin-bottom:18px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.card{background:white;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.08);padding:18px 20px;margin-bottom:18px}
.card-title{font-size:12px;font-weight:700;color:#1F3864;margin-bottom:12px;text-transform:uppercase;letter-spacing:.05em;border-bottom:2px solid #2E75B6;padding-bottom:6px}
.chart-wrap{position:relative}
.filter-btns{display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap}
.filter-btn{padding:4px 12px;border-radius:20px;border:1px solid #ddd;background:white;color:#1F3864;font-size:12px;font-weight:700}
.filter-btn.active{background:#1F3864;color:white;border-color:#1F3864}
.sort-btns{display:flex;gap:8px;align-items:center;margin-bottom:10px;font-size:12px;color:#6B7280}
.sort-btn{padding:3px 10px;border-radius:16px;border:1px solid #ddd;background:white;color:#1F3864;font-size:11px;font-weight:700}
.sort-btn.active{background:#1F3864;color:white;border-color:#1F3864}
.pill{display:inline-block;font-size:11px;font-weight:700;padding:2px 8px;border-radius:12px;color:white}
.pill-green{background:#27AE60}.pill-yellow{background:#F39C12}.pill-red{background:#E74C3C}
.pill-med{background:#F39C12}.pill-low{background:#27AE60}.pill-high{background:#E74C3C}
.pill-cat{background:#D9E2F3;color:#2E5FA3;font-size:11px;font-weight:600;padding:2px 7px;border-radius:10px}
.pill-critical{background:#E74C3C;color:white}
.progress-bar-wrap{background:#eee;border-radius:9px;height:18px;position:relative;overflow:hidden;margin-bottom:3px}
.progress-bar-fill{height:100%;border-radius:9px;position:absolute;top:0;left:0}
.progress-bar-label{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:white}
.heatmap-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:10px;margin-bottom:8px}
.heatmap-cell{border-radius:8px;padding:10px 8px;text-align:center;border:2px solid}
.heatmap-label{font-size:11px;font-weight:700;margin-bottom:4px}
.heatmap-sub{font-size:10px;color:#6B7280}
.risk-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:18px}
.risk-card{background:white;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.08);padding:14px 18px;border-left:4px solid}
.risk-name{font-size:13px;font-weight:700}
.risk-dots{display:flex;gap:2px}
.risk-dot{width:6px;height:6px;border-radius:2px;display:inline-block}
.opp-item{border-radius:8px;padding:8px 12px;border:1px solid;margin-bottom:8px}
.opp-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:2px}
.opp-title{font-weight:700;font-size:12px}
.opp-cat{font-size:10px;color:white;padding:1px 7px;border-radius:10px;font-weight:700}
.opp-detail{font-size:11px;color:#333}
.alert-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.alert-item{border-radius:8px;padding:10px 14px;border:1px solid}
.alert-title{font-weight:700;font-size:12px;margin-bottom:3px}
.alert-detail{font-size:11px;color:#333}
.insight-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.insight-item{border-left:4px solid;padding-left:12px}
.insight-rank{width:24px;height:24px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:white;margin-right:6px;flex-shrink:0}
.insight-label{font-weight:700;font-size:13px}
.insight-text{font-size:12px;color:#1A1A2E;margin-top:4px;line-height:1.5}
.kpi-list-item{display:flex;gap:10px;align-items:flex-start;padding:6px 0;border-bottom:1px solid #f0f0f0}
.kpi-num{color:#2E75B6;font-weight:700;font-size:13px;flex-shrink:0}
.kpi-text{font-size:12px;font-weight:600;color:#1A1A2E}
.kpi-cat{font-size:11px;color:#6B7280}
.dm-item{padding:7px 0;border-bottom:1px solid #f0f0f0}
.dm-rel{font-size:12px;font-weight:700;color:#1F3864}
.dm-desc{font-size:11px;color:#6B7280;margin-top:2px}
.capex-block{background:#F4F6F9;border-radius:8px;padding:12px}
.capex-title{font-size:13px;font-weight:700;margin-bottom:10px}
.capex-row{margin-bottom:7px}
.capex-label-row{display:flex;justify-content:space-between;font-size:11px;margin-bottom:2px}
.capex-track{background:#ddd;border-radius:4px;height:8px;overflow:hidden}
.capex-fill{height:100%;border-radius:4px}
.legend-row{display:flex;gap:12px;font-size:11px;margin-top:8px}
.legend-dot{width:10px;height:10px;border-radius:2px;display:inline-block;margin-right:4px}
.tbl-wrap{overflow-x:auto}
.fw{font-weight:600}.fw7{font-weight:700}
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div>
    <div class="header-title">‚ö° CAISO RegIntel Dashboard</div>
    <div class="header-sub">California ISO Regulatory Intelligence &nbsp;|&nbsp; Alvarez &amp; Marsal &nbsp;|&nbsp; Data: 2022‚Äì2025</div>
  </div>
  <div class="header-badges">
    <span style="font-size:11px;color:#94B3D0">Last updated:</span>
    <span class="badge-blue">February 2026</span>
    <span class="badge-green">‚óè LIVE</span>
  </div>
</div>

<!-- TABS -->
<div class="tabs">
  <button class="tab active" onclick="switchTab(0)">üìä Market Overview</button>
  <button class="tab" onclick="switchTab(1)">üåø Decarbonization &amp; Policy</button>
  <button class="tab" onclick="switchTab(2)">‚ö° Transmission &amp; Grid</button>
  <button class="tab" onclick="switchTab(3)">üí∞ Rate Cases &amp; Finance</button>
  <button class="tab" onclick="switchTab(4)">üõ°Ô∏è Risk &amp; Opportunity</button>
</div>

<!-- ‚ïê‚ïê‚ïê PAGE 1: MARKET OVERVIEW ‚ïê‚ïê‚ïê -->
<div class="content">
<div id="page0" class="page active">
  <div class="page-header">
    <div class="page-title">üìä Market Overview</div>
    <div class="page-source">Sources: CAISO Market Reports Q1‚ÄìQ3 2025 ¬∑ PG&amp;E/SCE/SDG&amp;E 2022 IRPs ¬∑ PacifiCorp IRP 2025</div>
  </div>
  <div class="kpi-grid">
    <div class="kpi" style="border-color:#27AE60"><div class="kpi-label">WEIM Renewable Gen (Q1 2025)</div><div class="kpi-value" style="color:#27AE60">42.9 GW</div><div class="kpi-sub">+4,910 MW vs Q1 2024 (+13%)</div></div>
    <div class="kpi" style="border-color:#2E75B6"><div class="kpi-label">CA Battery Discharge (Q1 2025)</div><div class="kpi-value" style="color:#2E75B6">1,400 MW</div><div class="kpi-sub">+59% YoY ‚Äî storage surging</div></div>
    <div class="kpi" style="border-color:#C9A84C"><div class="kpi-label">WEIM 15-Min Price (Q1 2025)</div><div class="kpi-value" style="color:#C9A84C">$37/MWh</div><div class="kpi-sub">Down 39% vs Q1 2024</div></div>
    <div class="kpi" style="border-color:#2E5FA3"><div class="kpi-label">CA Peak Demand Growth Rate</div><div class="kpi-value" style="color:#2E5FA3">1.53√ó</div><div class="kpi-sub">Bay Area: 2.14√ó (data centers + EV)</div></div>
  </div>
  <div class="grid-2-wide">
    <div class="card">
      <div class="card-title">Installed Capacity Mix by Utility</div>
      <div class="filter-btns" id="util-btns">
        <button class="filter-btn active" onclick="setUtil('PG&E',this)">PG&amp;E</button>
        <button class="filter-btn" onclick="setUtil('SCE',this)">SCE</button>
        <button class="filter-btn" onclick="setUtil('SDG&E',this)">SDG&amp;E</button>
        <button class="filter-btn" onclick="setUtil('PacifiCorp',this)">PacifiCorp</button>
      </div>
      <div class="chart-wrap" style="height:260px"><canvas id="genChart"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">WEIM Generation: Q1 2024 vs Q1 2025</div>
      <div class="chart-wrap" style="height:280px"><canvas id="weimChart"></canvas></div>
    </div>
  </div>
  <div class="card">
    <div class="card-title">Generation Mix Dataset ‚Äî Full Table</div>
    <div class="tbl-wrap"><table id="genTable">
      <thead><tr><th>Utility</th><th>Year</th><th>Technology</th><th style="text-align:right">Installed (MW)</th><th style="text-align:right">% Total</th><th style="text-align:right">Planned Add</th><th style="text-align:right">Planned Retire</th><th>Source</th></tr></thead>
      <tbody id="genTbody"></tbody>
    </table></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê PAGE 2: DECARBONIZATION ‚ïê‚ïê‚ïê -->
<div id="page1" class="page">
  <div class="page-header">
    <div class="page-title">üåø Decarbonization &amp; Policy</div>
    <div class="page-source">Sources: CA IRPs ¬∑ SB 100 ¬∑ AB 1279 ¬∑ AB 2163 ¬∑ CPUC ¬∑ State Legislation</div>
  </div>
  <div class="kpi-grid">
    <div class="kpi" style="border-color:#27AE60"><div class="kpi-label">PG&E Net-Zero Target</div><div class="kpi-value" style="color:#27AE60">2040</div><div class="kpi-sub">Climate positive by 2050</div></div>
    <div class="kpi" style="border-color:#2E75B6"><div class="kpi-label">SCE/SDG&E Clean Target</div><div class="kpi-value" style="color:#2E75B6">2045</div><div class="kpi-sub">100% per SB 100 + AB 1279</div></div>
    <div class="kpi" style="border-color:#C9A84C"><div class="kpi-label">AB 2163 Proposed 2035 RPS</div><div class="kpi-value" style="color:#C9A84C">90%</div><div class="kpi-sub">Up from 60% ‚Äî if enacted</div></div>
    <div class="kpi" style="border-color:#E74C3C"><div class="kpi-label">PacifiCorp Compliance Risk</div><div class="kpi-value" style="color:#E74C3C">HIGH</div><div class="kpi-sub">18% current RPS; coal-heavy</div></div>
  </div>
  <div class="grid-2-wide2">
    <div class="card">
      <div class="card-title">RPS Trajectory: Utility vs State Policy (2023‚Äì2045)</div>
      <div class="chart-wrap" style="height:280px"><canvas id="rpsChart"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">RPS &amp; Decarbonization Progress by Utility</div>
      <div id="rpsProgress"></div>
    </div>
  </div>
  <div class="card">
    <div class="card-title">Policy &amp; Legislative Dataset</div>
    <div class="tbl-wrap"><table>
      <thead><tr><th>Bill/Regulation</th><th>Year</th><th>Category</th><th>Priority</th><th>CAISO Market Impact</th><th>Affected Utilities</th><th>Source</th></tr></thead>
      <tbody id="policyTbody"></tbody>
    </table></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê PAGE 3: TRANSMISSION ‚ïê‚ïê‚ïê -->
<div id="page2" class="page">
  <div class="page-header">
    <div class="page-title">‚ö° Transmission &amp; Grid</div>
    <div class="page-source">Source: CAISO Board-Approved 2024-2025 Transmission Plan (May 30, 2025)</div>
  </div>
  <div class="kpi-grid">
    <div class="kpi" style="border-color:#1F3864"><div class="kpi-label">Total Transmission Investment</div><div class="kpi-value" style="color:#1F3864">$4.8B</div><div class="kpi-sub">31 projects ‚Äî 2024-2025 Plan</div></div>
    <div class="kpi" style="border-color:#2E75B6"><div class="kpi-label">Reliability-Driven</div><div class="kpi-value" style="color:#2E75B6">$4.57B</div><div class="kpi-sub">28 projects ‚Äî load growth &amp; VRE</div></div>
    <div class="kpi" style="border-color:#27AE60"><div class="kpi-label">Policy-Driven</div><div class="kpi-value" style="color:#27AE60">$289.5M</div><div class="kpi-sub">3 projects ‚Äî renewable access</div></div>
    <div class="kpi" style="border-color:#C9A84C"><div class="kpi-label">New Capacity Target (2039)</div><div class="kpi-value" style="color:#C9A84C">76 GW</div><div class="kpi-sub">CA CPUC portfolio requirement</div></div>
  </div>
  <div class="grid-2">
    <div class="card">
      <div class="card-title">Investment by Region ($M)</div>
      <div class="chart-wrap" style="height:260px"><canvas id="txRegionChart"></canvas></div>
      <div class="legend-row">
        <span><span class="legend-dot" style="background:#E74C3C"></span>High Congestion</span>
        <span><span class="legend-dot" style="background:#F39C12"></span>Moderate</span>
        <span><span class="legend-dot" style="background:#27AE60"></span>Low</span>
      </div>
    </div>
    <div class="card">
      <div class="card-title">Renewable vs Transmission Capacity by Zone (GW)</div>
      <div class="chart-wrap" style="height:260px"><canvas id="txGapChart"></canvas></div>
    </div>
  </div>
  <div class="card">
    <div class="card-title">Congestion Heatmap ‚Äî CAISO Planning Zones</div>
    <div class="heatmap-grid" id="heatmap"></div>
  </div>
  <div class="card">
    <div class="card-title">Transmission &amp; Congestion Dataset</div>
    <div class="sort-btns">Sort by: <button class="sort-btn active" onclick="sortTx('costM',this)">Cost</button> <button class="sort-btn" onclick="sortTx('inService',this)">In-Service</button></div>
    <div class="tbl-wrap"><table>
      <thead><tr><th>Project Name</th><th>Region</th><th style="text-align:right">Cost ($M)</th><th>In-Service</th><th>Congestion</th><th>Reliability</th><th>Policy</th><th>Linked Renewable Zones</th></tr></thead>
      <tbody id="txTbody"></tbody>
    </table></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê PAGE 4: RATE CASES ‚ïê‚ïê‚ïê -->
<div id="page3" class="page">
  <div class="page-header">
    <div class="page-title">üí∞ Rate Cases &amp; Finance</div>
    <div class="page-source">Sources: CPUC A.21-06-021 (PG&amp;E) ¬∑ A.23-05-010 (SCE) ¬∑ Oregon PUC Order 24-447 (PacifiCorp)</div>
  </div>
  <div class="kpi-grid">
    <div class="kpi" style="border-color:#1F3864"><div class="kpi-label">PG&E 2026 Revenue Req.</div><div class="kpi-value" style="color:#1F3864">$14.9B</div><div class="kpi-sub">+$1.1B vs 2023 (+8.3%)</div></div>
    <div class="kpi" style="border-color:#E74C3C"><div class="kpi-label">SCE 2025 Revenue Req.</div><div class="kpi-value" style="color:#E74C3C">$9.2B</div><div class="kpi-sub">TY 2025 GRC proposed decision</div></div>
    <div class="kpi" style="border-color:#F39C12"><div class="kpi-label">PacifiCorp Approved ROE</div><div class="kpi-value" style="color:#F39C12">9.5%</div><div class="kpi-sub">Maintained at current level (OR PUC)</div></div>
    <div class="kpi" style="border-color:#C9A84C"><div class="kpi-label">PacifiCorp Rate Increase</div><div class="kpi-value" style="color:#C9A84C">8.5%</div><div class="kpi-sub">Reduced from requested 17.9%</div></div>
  </div>
  <div class="grid-2-wide2">
    <div class="card">
      <div class="card-title">Authorized Revenue Requirement Trend ($B)</div>
      <div class="chart-wrap" style="height:270px"><canvas id="revChart"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">ROE &amp; Cost of Capital Comparison</div>
      <div class="chart-wrap" style="height:270px"><canvas id="roeChart"></canvas></div>
    </div>
  </div>
  <div class="card">
    <div class="card-title">Rate Case &amp; Financial Dataset</div>
    <div class="tbl-wrap"><table>
      <thead><tr><th>Utility</th><th>Case Year</th><th style="text-align:right">ROE</th><th style="text-align:right">Equity %</th><th style="text-align:right">LT Debt</th><th style="text-align:right">Revenue Req.</th><th style="text-align:right">Rate Inc.</th><th>Disallowed Costs</th><th>CapEx Focus</th><th>Source</th></tr></thead>
      <tbody id="rateTbody"></tbody>
    </table></div>
  </div>
  <div class="card">
    <div class="card-title">Capital Expenditure Focus Areas by Utility</div>
    <div class="grid-3" id="capexGrid"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê PAGE 5: RISK ‚ïê‚ïê‚ïê -->
<div id="page4" class="page">
  <div class="page-header">
    <div class="page-title">üõ°Ô∏è Risk &amp; Opportunity</div>
    <div class="page-source">Sources: Cross-document synthesis ‚Äî all IRPs, Rate Cases, Market Reports, Legislation</div>
  </div>
  <div class="risk-grid" id="riskCards"></div>
  <div class="grid-2">
    <div class="card">
      <div class="card-title">Regulatory Risk Radar (10 = Highest Risk)</div>
      <div class="chart-wrap" style="height:280px"><canvas id="radarChart"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">Investment Opportunity Flags</div>
      <div id="oppList"></div>
    </div>
  </div>
  <div class="card">
    <div class="card-title">Live Market Alerts &amp; Structural Risk Flags</div>
    <div class="alert-grid" id="alertGrid"></div>
  </div>
  <div class="card">
    <div class="card-title">Cross-Document Intelligence ‚Äî Ranked Insights</div>
    <div class="insight-grid" id="insightGrid"></div>
  </div>
  <div class="grid-2">
    <div class="card">
      <div class="card-title">Suggested Executive KPIs</div>
      <div id="kpiList"></div>
    </div>
    <div class="card">
      <div class="card-title">Data Model Relationships</div>
      <div id="dmList"></div>
    </div>
  </div>
</div>
</div><!-- /content -->

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const UTIL_COLORS={"PG&E":"#1F3864","SCE":"#E74C3C","SDG&E":"#27AE60","PacifiCorp":"#F39C12"};
const FUEL_COLORS={Solar:"#F4C430",Wind:"#5DADE2",Gas:"#E67E22",Nuclear:"#8E44AD",Hydro:"#1ABC9C",Storage:"#27AE60",Coal:"#7F8C8D",Geothermal:"#D35400",Biomass:"#2ECC71",Other:"#BDC3C7"};
const CONG_COLORS={High:"#E74C3C",Moderate:"#F39C12",Low:"#27AE60"};

const generationMix=[
  {utility:"PG&E",year:2022,technology:"Solar",installedMW:8200,pct:22,plannedAdd:3500,plannedRet:0,source:"PG&E 2022 IRP"},
  {utility:"PG&E",year:2022,technology:"Wind",installedMW:4800,pct:13,plannedAdd:2200,plannedRet:0,source:"PG&E 2022 IRP"},
  {utility:"PG&E",year:2022,technology:"Hydro",installedMW:5200,pct:14,plannedAdd:0,plannedRet:0,source:"PG&E 2022 IRP"},
  {utility:"PG&E",year:2022,technology:"Nuclear",installedMW:2300,pct:6,plannedAdd:0,plannedRet:2300,source:"PG&E 2022 IRP"},
  {utility:"PG&E",year:2022,technology:"Gas",installedMW:8100,pct:22,plannedAdd:0,plannedRet:3000,source:"PG&E 2022 IRP"},
  {utility:"PG&E",year:2022,technology:"Storage",installedMW:1800,pct:5,plannedAdd:3200,plannedRet:0,source:"PG&E 2022 IRP"},
  {utility:"PG&E",year:2022,technology:"Geothermal",installedMW:900,pct:2,plannedAdd:400,plannedRet:0,source:"PG&E 2022 IRP"},
  {utility:"PG&E",year:2022,technology:"Other",installedMW:6100,pct:16,plannedAdd:800,plannedRet:0,source:"PG&E 2022 IRP"},
  {utility:"SCE",year:2022,technology:"Solar",installedMW:6800,pct:25,plannedAdd:4500,plannedRet:0,source:"SCE 2022 IRP"},
  {utility:"SCE",year:2022,technology:"Wind",installedMW:3200,pct:12,plannedAdd:2800,plannedRet:0,source:"SCE 2022 IRP"},
  {utility:"SCE",year:2022,technology:"Gas",installedMW:8500,pct:31,plannedAdd:0,plannedRet:4200,source:"SCE 2022 IRP"},
  {utility:"SCE",year:2022,technology:"Storage",installedMW:1900,pct:7,plannedAdd:4000,plannedRet:0,source:"SCE 2022 IRP"},
  {utility:"SCE",year:2022,technology:"Hydro",installedMW:1400,pct:5,plannedAdd:0,plannedRet:0,source:"SCE 2022 IRP"},
  {utility:"SCE",year:2022,technology:"Geothermal",installedMW:700,pct:3,plannedAdd:600,plannedRet:0,source:"SCE 2022 IRP"},
  {utility:"SCE",year:2022,technology:"Other",installedMW:4600,pct:17,plannedAdd:900,plannedRet:0,source:"SCE 2022 IRP"},
  {utility:"SDG&E",year:2022,technology:"Solar",installedMW:1950,pct:28,plannedAdd:800,plannedRet:0,source:"SDG&E 2022 IIRP"},
  {utility:"SDG&E",year:2022,technology:"Wind",installedMW:520,pct:7,plannedAdd:300,plannedRet:0,source:"SDG&E 2022 IIRP"},
  {utility:"SDG&E",year:2022,technology:"Gas",installedMW:1800,pct:26,plannedAdd:0,plannedRet:700,source:"SDG&E 2022 IIRP"},
  {utility:"SDG&E",year:2022,technology:"Storage",installedMW:620,pct:9,plannedAdd:600,plannedRet:0,source:"SDG&E 2022 IIRP"},
  {utility:"SDG&E",year:2022,technology:"Other",installedMW:2110,pct:30,plannedAdd:446,plannedRet:0,source:"SDG&E 2022 IIRP"},
  {utility:"PacifiCorp",year:2024,technology:"Coal",installedMW:8200,pct:35,plannedAdd:0,plannedRet:5500,source:"PacifiCorp IRP 2025"},
  {utility:"PacifiCorp",year:2024,technology:"Gas",installedMW:4200,pct:18,plannedAdd:0,plannedRet:1200,source:"PacifiCorp IRP 2025"},
  {utility:"PacifiCorp",year:2024,technology:"Hydro",installedMW:3100,pct:13,plannedAdd:0,plannedRet:0,source:"PacifiCorp IRP 2025"},
  {utility:"PacifiCorp",year:2024,technology:"Wind",installedMW:3600,pct:15,plannedAdd:4200,plannedRet:0,source:"PacifiCorp IRP 2025"},
  {utility:"PacifiCorp",year:2024,technology:"Solar",installedMW:1500,pct:6,plannedAdd:3800,plannedRet:0,source:"PacifiCorp IRP 2025"},
  {utility:"PacifiCorp",year:2024,technology:"Storage",installedMW:400,pct:2,plannedAdd:2000,plannedRet:0,source:"PacifiCorp IRP 2025"},
  {utility:"PacifiCorp",year:2024,technology:"Other",installedMW:2600,pct:11,plannedAdd:400,plannedRet:0,source:"PacifiCorp IRP 2025"},
];

const weim2025=[
  {technology:"Solar",q2024:3900,q2025:4760},
  {technology:"Wind",q2024:7636,q2025:8476},
  {technology:"Storage",q2024:880,q2025:1400},
  {technology:"Gas",q2024:3143,q2025:2923},
  {technology:"Coal",q2024:3087,q2025:3797},
  {technology:"Biomass",q2024:889,q2025:809},
];

const rpsTimeline=[
  {year:2023,statePolicy:40,pge:55,sce:48,sdge:44,pacifico:18},
  {year:2025,statePolicy:50,pge:58,sce:52,sdge:47,pacifico:21},
  {year:2027,statePolicy:60,pge:62,sce:57,sdge:52,pacifico:24},
  {year:2030,statePolicy:70,pge:70,sce:65,sdge:60,pacifico:35},
  {year:2035,statePolicy:90,pge:80,sce:80,sdge:75,pacifico:50},
  {year:2040,statePolicy:95,pge:100,sce:90,sdge:88,pacifico:65},
  {year:2045,statePolicy:100,pge:100,sce:100,sdge:100,pacifico:80},
];

const rpsData=[
  {utility:"PG&E",current:55,t2030:70,netZero:2040,ghg:"30 MMT by 2035",risk:"Low"},
  {utility:"SCE",current:48,t2030:65,netZero:2045,ghg:"25 MMT by 2035",risk:"Low"},
  {utility:"SDG&E",current:44,t2030:60,netZero:2045,ghg:"25 MMT by 2035",risk:"Moderate"},
  {utility:"PacifiCorp",current:18,t2030:35,netZero:2050,ghg:"Multi-state",risk:"High"},
];

const policyData=[
  {bill:"AB 1279 (Climate Crisis Act)",year:2022,cat:"Emissions",priority:"Critical",impact:"Mandates net-zero GHG by 2045 and net-negative thereafter; 85% below 1990 levels.",util:"All CA IOUs",src:"CA Chapter 337"},
  {bill:"SB 100",year:2018,cat:"RPS",priority:"Critical",impact:"100% clean electricity by 2045 ‚Äî primary driver of all IRP procurement mandates.",util:"All CA LSEs",src:"California SB 100"},
  {bill:"AB 2163 (Proposed 2026)",year:2026,cat:"RPS",priority:"High",impact:"Proposes 90% by 2035, 95% by 2040 ‚Äî compressing IRP timeline by 10+ years.",util:"All CA LSEs",src:"CA A.2163 2025-26"},
  {bill:"SB 400 (IRA Prevailing Wage)",year:2023,cat:"Clean Energy Finance",priority:"High",impact:"Enables IRA direct-pay credits worth hundreds of millions annually.",util:"All utilities",src:"CA Chapter 220"},
  {bill:"AB 706 (FOREST/BioMAT)",year:2025,cat:"Bioenergy",priority:"Medium",impact:"Extends BioMAT/BioRAM; preserves $30M federal funding for two BioMAT projects.",util:"PG&E, SCE, SDG&E",src:"CA A.706 2025-26"},
  {bill:"AB 864 (PV Recycling)",year:2025,cat:"DER / Circular Economy",priority:"Medium",impact:"End-of-life framework for solar PV modules; compliance obligations for asset owners.",util:"All CA IOUs",src:"CA A.864 2025-26"},
  {bill:"AB 443 (H2 from Curtailment)",year:2025,cat:"Storage / Hydrogen",priority:"Medium",impact:"Requires CEC to assess hydrogen production from curtailed solar/wind in 2027 IEPR.",util:"All CA LSEs",src:"CA A.443 2025-26"},
  {bill:"SB 327 (Cost Transparency)",year:2025,cat:"Regulatory Reform",priority:"Medium",impact:"Bars recovery of lobbying and trade association costs; civil penalty risk.",util:"PG&E, SCE, SDG&E, PacifiCorp",src:"CA S.327 2025-26"},
  {bill:"SB 58 (H2S Air Quality)",year:2025,cat:"Environmental",priority:"Low",impact:"Updates 1969 H2S ambient standard; impacts geothermal ops near Salton Sea.",util:"SDG&E, SCE",src:"CA S.58 2025-26"},
  {bill:"FERC Order 1920/1920-A",year:2024,cat:"Transmission Reform",priority:"High",impact:"Requires 20-year long-term transmission planning aligned with state clean energy.",util:"CAISO / All western utilities",src:"FERC Order 1920"},
  {bill:"FERC Order 2023 (Queue Reform)",year:2023,cat:"Interconnection",priority:"High",impact:"Cluster-based interconnection with financial milestones to clear CAISO queue backlog.",util:"CAISO / All developers",src:"FERC Order 2023"},
];

const txProjects=[
  {name:"North Oakland Reinforcement",region:"PG&E GBA",costM:1127,inService:2033,congestion:"High",reliability:true,policy:false,zones:"Data centers, import access"},
  {name:"Greater Bay Area 500 kV Reinforcement",region:"PG&E GBA",costM:700,inService:2031,congestion:"High",reliability:true,policy:false,zones:"Data centers, EV loads"},
  {name:"Downtown Reliability Reinforcement",region:"SDG&E",costM:500,inService:2032,congestion:"High",reliability:true,policy:false,zones:"Downtown SD reliability"},
  {name:"South Bay Reinforcement",region:"PG&E GBA",costM:434,inService:2032,congestion:"Moderate",reliability:true,policy:false,zones:"Bay Area load growth"},
  {name:"South Oakland Reinforcement",region:"PG&E GBA",costM:250,inService:2031,congestion:"Moderate",reliability:true,policy:false,zones:"East Bay load growth"},
  {name:"San Jose B ‚Äì NRS 230 kV Line",region:"PG&E GBA",costM:200,inService:2030,congestion:"Moderate",reliability:true,policy:false,zones:"Silicon Valley data centers"},
  {name:"Serrano 500 kV SCD Mitigation",region:"SCE Main",costM:183,inService:2029,congestion:"Moderate",reliability:true,policy:false,zones:"SCE stability mitigation"},
  {name:"Metcalf 500/230 kV Transformer",region:"PG&E GBA",costM:182,inService:2030,congestion:"Moderate",reliability:true,policy:false,zones:"Bay Area system support"},
  {name:"New Helm 230/70 kV Bank #2",region:"PG&E Fresno",costM:115,inService:2030,congestion:"Low",reliability:false,policy:true,zones:"Westlands / Fresno solar"},
  {name:"Eagle Rock-Fulton-Silverado Reconductor",region:"PG&E NCNB",costM:92.9,inService:2029,congestion:"Low",reliability:false,policy:true,zones:"North Coast renewables"},
  {name:"GWF-Kingsburg 115 kV Reconductor",region:"PG&E Fresno",costM:81.6,inService:2029,congestion:"Low",reliability:false,policy:true,zones:"Central Valley solar"},
  {name:"Julian Hinds-Mirage 230 kV Reconductor",region:"SCE Eastern",costM:76,inService:2028,congestion:"Moderate",reliability:true,policy:false,zones:"Inland Empire solar"},
  {name:"West Fresno 115 kV Voltage Support",region:"PG&E Fresno",costM:60,inService:2028,congestion:"Low",reliability:true,policy:false,zones:"Central Valley reliability"},
  {name:"Coronado Island Reinforcement Ph II",region:"SDG&E",costM:66,inService:2029,congestion:"Low",reliability:true,policy:false,zones:"Island reliability"},
  {name:"Gold Hill-El Dorado Reinforcement",region:"PG&E CVLY",costM:127,inService:2030,congestion:"Low",reliability:true,policy:false,zones:"Central Valley reliability"},
];

const txByRegion=[
  {region:"PG&E GBA",costM:2993,projects:7,cong:"High",renGW:12,txGW:8},
  {region:"SDG&E",costM:566,projects:2,cong:"High",renGW:3,txGW:2.8},
  {region:"SCE Main",costM:211,projects:2,cong:"Moderate",renGW:18,txGW:16},
  {region:"PG&E Fresno",costM:257,projects:3,cong:"Low",renGW:8,txGW:7},
  {region:"PG&E NCNB",costM:125,projects:2,cong:"Low",renGW:4,txGW:3.5},
  {region:"SCE Eastern",costM:76,projects:1,cong:"Moderate",renGW:6,txGW:5.2},
  {region:"PG&E CVLY",costM:127,projects:1,cong:"Low",renGW:5,txGW:4.5},
];

const rateCases=[
  {util:"PG&E",year:2023,roe:10.2,eq:52,ltD:4.8,revB:13.761,inc:null,dis:"Wildfire prudence review pending",capex:"Wildfire hardening ($2.1B), grid modernization",src:"CPUC A.21-06-021"},
  {util:"PG&E",year:2024,roe:10.2,eq:52,ltD:4.8,revB:14.439,inc:4.9,dis:"N/A",capex:"Wildfire undergrounding / covered conductor",src:"CPUC A.21-06-021"},
  {util:"PG&E",year:2025,roe:10.2,eq:52,ltD:4.8,revB:14.745,inc:2.1,dis:"N/A",capex:"Wildfire hardening, electrification infra",src:"CPUC A.21-06-021"},
  {util:"PG&E",year:2026,roe:10.2,eq:52,ltD:4.8,revB:14.908,inc:1.1,dis:"N/A",capex:"Wildfire hardening, electrification infra",src:"CPUC A.21-06-021"},
  {util:"SCE",year:2025,roe:10.05,eq:52,ltD:5.1,revB:9.2,inc:null,dis:"DIR scope reductions under review",capex:"Distribution Infrastructure Replacement, substation rebuild",src:"CPUC A.23-05-010"},
  {util:"PacifiCorp",year:2024,roe:9.5,eq:50,ltD:5.301,revB:1.86,inc:8.5,dis:"2020 wildfire costs ‚Äî prudence review required",capex:"Distribution system plan, wildfire mitigation, insurance",src:"Oregon PUC Order 24-447"},
];

const revTrend=[
  {year:2021,PGE:12.8,SCE:8.1,SDGE:2.4,PAC:1.65},
  {year:2022,PGE:13.1,SCE:8.4,SDGE:2.5,PAC:1.70},
  {year:2023,PGE:13.761,SCE:8.7,SDGE:2.6,PAC:1.78},
  {year:2024,PGE:14.439,SCE:8.9,SDGE:2.7,PAC:1.86},
  {year:2025,PGE:14.745,SCE:9.2,SDGE:2.8,PAC:2.0},
  {year:2026,PGE:14.908,SCE:9.5,SDGE:2.9,PAC:2.1},
];

const roeData=[
  {util:"PG&E",roe:10.2,ltd:4.8,avg:9.5},
  {util:"SCE",roe:10.05,ltd:5.1,avg:9.5},
  {util:"SDG&E (est)",roe:9.8,ltd:5.0,avg:9.5},
  {util:"PacifiCorp",roe:9.5,ltd:5.301,avg:9.5},
];

const riskScores=[
  {util:"PG&E",wildfire:8,rps:7,financial:5,txGap:7,afford:8,overall:"Yellow"},
  {util:"SCE",wildfire:6,rps:8,financial:7,txGap:6,afford:6,overall:"Yellow"},
  {util:"SDG&E",wildfire:4,rps:6,financial:8,txGap:5,afford:5,overall:"Green"},
  {util:"PacifiCorp",wildfire:9,rps:4,financial:4,txGap:3,afford:7,overall:"Red"},
];

const opportunities=[
  {title:"Battery Storage Procurement Wave",cat:"Storage",flag:"Green",detail:"Battery discharge +59% YoY in CA (Q1 2025). CPUC MTR orders driving 4,000+ MW additional procurement by 2027."},
  {title:"Greater Bay Area Competitive Solicitation",cat:"Transmission",flag:"Green",detail:"San Jose B ‚Äì NRS 230 kV and Metcalf 500 kV eligible for competitive solicitation. ~$1B opportunity."},
  {title:"Out-of-State Wind Import Corridors",cat:"Wind",flag:"Yellow",detail:"CAISO targets 9 GW out-of-state wind from ID, WY, NM. Requires import corridor transmission with 8-10yr lead time."},
  {title:"Morro Bay & Humboldt Offshore Wind",cat:"Offshore Wind",flag:"Yellow",detail:"4.5 GW planned. High return potential but 5-10 year permitting/interconnection uncertainty."},
  {title:"Green Hydrogen from Curtailed Renewables",cat:"Hydrogen",flag:"Yellow",detail:"AB 443 mandates 2027 CEC assessment. Mid-day curtailment of -6,370 MW creates electrolysis opportunity."},
  {title:"BioMAT/BioRAM Program Extension",cat:"Bioenergy",flag:"Green",detail:"AB 706 preserves 47M ton biomass potential and $30M federal funding for two BioMAT projects."},
  {title:"IRA Direct Pay (SB 400)",cat:"Compliance",flag:"Green",detail:"SB 400 enables CA IOUs and tax-exempt entities to claim IRA direct pay credits, potentially hundreds of millions annually."},
];

const alerts=[
  {type:"Red",title:"PacifiCorp Dividend Suspension",detail:"Dividends suspended through 2028. Wildfire liability + coal transition cost pressure is systemic."},
  {type:"Red",title:"AB 2163 RPS Acceleration Risk",detail:"If enacted, 90% by 2035 collapses the IRP timeline. Utilities may face procurement gaps starting 2028-2030."},
  {type:"Yellow",title:"CRR Market Losses",detail:"CRR payouts exceeded revenues by $19.3M in Q1 2025. Structural transmission ratepayer cost."},
  {type:"Yellow",title:"Greater Bay Area Load Surge",detail:"Peak demand growth rate doubled to 2.14 (data centers + EVs). Transmission has 8-10yr lead times."},
  {type:"Yellow",title:"Wildfire Insurance Cost Pressure",detail:"PacifiCorp sought $66M insurance + $77.7M fire fund. CA IOUs face similar pressures."},
  {type:"Green",title:"Q1 2025 Price Normalization",detail:"WEIM 15-min prices down 39% vs Q1 2024 ($37/MWh). Lower input costs benefit clean procurement."},
  {type:"Green",title:"Battery Storage Deployment Surge",detail:"+59% YoY battery discharge in CA. Storage is now a material grid resource."},
];

const insights=[
  {rank:"#1",label:"Most Aggressive Decarbonization",color:"#27AE60",text:"PG&E leads with net-zero by 2040 (5 yrs ahead of state mandate) and climate-positive by 2050. SCE follows with 25 MMT target for 2035. Both utilities are ahead of SDG&E on adoption timing."},
  {rank:"#2",label:"Highest Compliance Risk",color:"#E74C3C",text:"PacifiCorp (Red flag) faces multi-state coal retirement liability, wildfire exposure, ROE pressure, dividend suspension through 2028, and 18% current RPS vs. state peers at 44-55%. Systemic financial risk."},
  {rank:"#3",label:"Transmission-Renewable Gap Hotspot",color:"#C9A84C",text:"Greater Bay Area has the widest gap between projected renewable/load capacity and existing transmission. $2.7B in new investment needed but 8-10yr development lead times create near-term reliability risk through 2033."},
  {rank:"#4",label:"Rate Case-IRP Capital Correlation",color:"#2E75B6",text:"PG&E's $14.9B 2026 revenue requirement directly tracks IRP wildfire hardening + electrification capex. Rate cases and IRP procurement orders are co-creating a compounding rate pressure cycle on CA customers."},
  {rank:"#5",label:"Duck Curve Deepening",color:"#2E5FA3",text:"WEIM mid-day net battery generation at -6,370 MW signals the duck curve is deeper than ever. Curtailment risk is growing faster than storage deployment can offset. AB 443 hydrogen study is the next policy lever."},
  {rank:"#6",label:"Policy-Market Feedback Loop",color:"#1F3864",text:"AB 2163's 90% by 2035 mandate (proposed), if enacted, would compress the current IRP timeline by ~10 years, requiring near-immediate procurement acceleration and significant supply chain pressure."},
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TAB SWITCHING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchTab(i){
  document.querySelectorAll('.tab').forEach((t,j)=>t.classList.toggle('active',i===j));
  document.querySelectorAll('.page').forEach((p,j)=>p.classList.toggle('active',i===j));
  if(i===0&&!charts.gen) buildPage1();
  if(i===1&&!charts.rps) buildPage2();
  if(i===2&&!charts.txRegion) buildPage3();
  if(i===3&&!charts.rev) buildPage4();
  if(i===4&&!charts.radar) buildPage5();
}

const charts={};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PAGE 1
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentUtil="PG&E";
function buildPage1(){
  // Gen table
  const tb=document.getElementById('genTbody');
  generationMix.forEach((r,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td class="fw" style="color:${UTIL_COLORS[r.utility]||'#333'}">${r.utility}</td>
      <td>${r.year}</td>
      <td><span style="display:inline-flex;align-items:center;gap:4px"><span style="width:10px;height:10px;border-radius:2px;background:${FUEL_COLORS[r.technology]||'#aaa'};display:inline-block"></span>${r.technology}</span></td>
      <td style="text-align:right">${r.installedMW.toLocaleString()}</td>
      <td style="text-align:right">${r.pct}%</td>
      <td style="text-align:right;color:${r.plannedAdd>0?'#27AE60':'#999'}">${r.plannedAdd>0?'+'+r.plannedAdd.toLocaleString():'‚Äî'}</td>
      <td style="text-align:right;color:${r.plannedRet>0?'#E74C3C':'#999'}">${r.plannedRet>0?r.plannedRet.toLocaleString():'‚Äî'}</td>
      <td style="color:#999;font-size:11px">${r.source}</td>`;
    tb.appendChild(tr);
  });
  buildGenChart(currentUtil);
  // WEIM chart
  charts.weim=new Chart(document.getElementById('weimChart'),{
    type:'bar',
    data:{
      labels:weim2025.map(r=>r.technology),
      datasets:[
        {label:'Q1 2024 (MW)',data:weim2025.map(r=>r.q2024),backgroundColor:'#D9E2F3',borderRadius:4},
        {label:'Q1 2025 (MW)',data:weim2025.map(r=>r.q2025),backgroundColor:'#2E75B6',borderRadius:4},
      ]
    },
    options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{font:{size:11}}}},scales:{x:{ticks:{font:{size:10}}},y:{ticks:{font:{size:11}}}}}
  });
}

function buildGenChart(util){
  const rows=generationMix.filter(r=>r.utility===util);
  const labels=rows.map(r=>r.technology);
  const colors=rows.map(r=>FUEL_COLORS[r.technology]||'#aaa');
  if(charts.gen) charts.gen.destroy();
  charts.gen=new Chart(document.getElementById('genChart'),{
    type:'bar',
    data:{
      labels,
      datasets:[
        {label:'Installed (MW)',data:rows.map(r=>r.installedMW),backgroundColor:colors,borderRadius:3},
        {label:'Planned Add (MW)',data:rows.map(r=>r.plannedAdd),backgroundColor:'rgba(39,174,96,.7)',borderRadius:3},
        {label:'Planned Retire (MW)',data:rows.map(r=>r.plannedRet),backgroundColor:'rgba(231,76,60,.7)',borderRadius:3},
      ]
    },
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{font:{size:11}}}},scales:{x:{ticks:{font:{size:11}}},y:{ticks:{font:{size:11}}}}}
  });
}

function setUtil(util,btn){
  currentUtil=util;
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  buildGenChart(util);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PAGE 2
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildPage2(){
  // RPS line chart
  charts.rps=new Chart(document.getElementById('rpsChart'),{
    type:'line',
    data:{
      labels:rpsTimeline.map(r=>r.year),
      datasets:[
        {label:'AB 2163 Mandate',data:rpsTimeline.map(r=>r.statePolicy),borderColor:'#E74C3C',borderWidth:2.5,borderDash:[6,3],pointRadius:0,fill:false},
        {label:'PG&E',data:rpsTimeline.map(r=>r.pge),borderColor:'#1F3864',borderWidth:2,pointRadius:0,fill:false},
        {label:'SCE',data:rpsTimeline.map(r=>r.sce),borderColor:'#E74C3C',borderWidth:2,pointRadius:0,fill:false,borderDash:[4,2]},
        {label:'SDG&E',data:rpsTimeline.map(r=>r.sdge),borderColor:'#27AE60',borderWidth:2,pointRadius:0,fill:false},
        {label:'PacifiCorp',data:rpsTimeline.map(r=>r.pacifico),borderColor:'#F39C12',borderWidth:2,pointRadius:0,fill:false},
      ]
    },
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{font:{size:11}}}},scales:{y:{min:0,max:105,ticks:{callback:v=>v+'%',font:{size:11}}},x:{ticks:{font:{size:11}}}}}
  });
  // Progress bars
  const el=document.getElementById('rpsProgress');
  rpsData.forEach(r=>{
    el.innerHTML+=`<div style="margin-bottom:14px">
      <div style="display:flex;justify-content:space-between;margin-bottom:3px">
        <span style="font-size:13px;font-weight:700;color:${UTIL_COLORS[r.utility]||'#333'}">${r.utility}</span>
        <span style="font-size:12px;color:#6B7280">Current: ${r.current}% ‚Üí 2030: ${r.t2030}%</span>
      </div>
      <div class="progress-bar-wrap">
        <div class="progress-bar-fill" style="width:${r.current}%;background:${UTIL_COLORS[r.utility]||'#2E75B6'}"></div>
        <div class="progress-bar-label">${r.current}% Current</div>
      </div>
      <div style="display:flex;gap:12px;font-size:11px;color:#6B7280;margin-top:3px">
        <span>Net-Zero: <b style="color:#333">${r.netZero}</b></span>
        <span>GHG: <b style="color:#333">${r.ghg}</b></span>
        <span class="pill pill-${r.risk.toLowerCase()}">${r.risk}</span>
      </div>
    </div>`;
  });
  // Policy table
  const tb=document.getElementById('policyTbody');
  policyData.forEach((r,i)=>{
    const pc=r.priority==='Critical'?'pill-critical':r.priority==='High'?'pill-high':r.priority==='Medium'?'pill-med':'pill-low';
    const tr=document.createElement('tr');
    tr.innerHTML=`<td class="fw7" style="color:#1F3864">${r.bill}</td>
      <td>${r.year}</td>
      <td><span class="pill-cat">${r.cat}</span></td>
      <td><span class="pill ${pc}">${r.priority}</span></td>
      <td style="max-width:260px">${r.impact}</td>
      <td style="color:#999">${r.util}</td>
      <td style="color:#999;font-size:11px">${r.src}</td>`;
    tb.appendChild(tr);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PAGE 3
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildPage3(){
  // Region cost chart
  charts.txRegion=new Chart(document.getElementById('txRegionChart'),{
    type:'bar',
    data:{
      labels:txByRegion.map(r=>r.region),
      datasets:[{
        label:'Investment ($M)',
        data:txByRegion.map(r=>r.costM),
        backgroundColor:txByRegion.map(r=>CONG_COLORS[r.cong]),
        borderRadius:4
      }]
    },
    options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{callback:v=>'$'+v+'M',font:{size:10}}},y:{ticks:{font:{size:10}}}}}
  });
  // Gap chart
  charts.txGap=new Chart(document.getElementById('txGapChart'),{
    type:'bar',
    data:{
      labels:txByRegion.map(r=>r.region),
      datasets:[
        {label:'Renewable Capacity (GW)',data:txByRegion.map(r=>r.renGW),backgroundColor:'rgba(39,174,96,.8)',borderRadius:3},
        {label:'Transmission Capacity (GW)',data:txByRegion.map(r=>r.txGW),backgroundColor:'rgba(46,117,182,.8)',borderRadius:3},
      ]
    },
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{font:{size:11}}}},scales:{x:{ticks:{font:{size:9}}},y:{ticks:{callback:v=>v+'GW',font:{size:11}}}}}
  });
  // Heatmap
  const hm=document.getElementById('heatmap');
  txByRegion.forEach(z=>{
    const c=CONG_COLORS[z.cong];
    hm.innerHTML+=`<div class="heatmap-cell" style="background:${c}22;border-color:${c}">
      <div class="heatmap-label" style="color:${c}">${z.region}</div>
      <div class="heatmap-sub">$${z.costM}M</div>
      <div class="heatmap-sub">${z.projects} proj.</div>
      <div style="font-size:10px;font-weight:700;color:${c}">${z.cong}</div>
    </div>`;
  });
  // Tx table
  renderTxTable('costM');
}

function renderTxTable(col){
  const sorted=[...txProjects].sort((a,b)=>b[col]-a[col]);
  const tb=document.getElementById('txTbody');
  tb.innerHTML='';
  sorted.forEach((r,i)=>{
    const cc=r.costM>=400?'#E74C3C':r.costM>=100?'#C9A84C':'#27AE60';
    const pc=r.congestion==='High'?'pill-high':r.congestion==='Moderate'?'pill-med':'pill-low';
    const tr=document.createElement('tr');
    tr.innerHTML=`<td class="fw" style="color:#1F3864">${r.name}</td>
      <td>${r.region}</td>
      <td style="text-align:right;font-weight:700;color:${cc}">$${r.costM}M</td>
      <td>${r.inService}</td>
      <td><span class="pill ${pc}">${r.congestion}</span></td>
      <td style="text-align:center">${r.reliability?'‚úÖ':'‚Äî'}</td>
      <td style="text-align:center">${r.policy?'‚úÖ':'‚Äî'}</td>
      <td style="color:#999;font-size:11px">${r.zones}</td>`;
    tb.appendChild(tr);
  });
}

function sortTx(col,btn){
  document.querySelectorAll('.sort-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderTxTable(col);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PAGE 4
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildPage4(){
  // Revenue trend
  charts.rev=new Chart(document.getElementById('revChart'),{
    type:'line',
    data:{
      labels:revTrend.map(r=>r.year),
      datasets:[
        {label:'PG&E ($B)',data:revTrend.map(r=>r.PGE),borderColor:'#1F3864',borderWidth:2.5,pointRadius:3,fill:false},
        {label:'SCE ($B)',data:revTrend.map(r=>r.SCE),borderColor:'#E74C3C',borderWidth:2.5,pointRadius:3,fill:false},
        {label:'SDG&E Est. ($B)',data:revTrend.map(r=>r.SDGE),borderColor:'#27AE60',borderWidth:2,borderDash:[4,2],pointRadius:2,fill:false},
        {label:'PacifiCorp ($B)',data:revTrend.map(r=>r.PAC),borderColor:'#F39C12',borderWidth:2,pointRadius:3,fill:false},
      ]
    },
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{font:{size:11}}}},scales:{y:{min:1,max:16,ticks:{callback:v=>'$'+v+'B',font:{size:11}}},x:{ticks:{font:{size:11}}}}}
  });
  // ROE chart
  charts.roe=new Chart(document.getElementById('roeChart'),{
    type:'bar',
    data:{
      labels:roeData.map(r=>r.util),
      datasets:[
        {label:'Allowed ROE (%)',data:roeData.map(r=>r.roe),backgroundColor:'#2E75B6',borderRadius:4},
        {label:'LT Debt Cost (%)',data:roeData.map(r=>r.ltd),backgroundColor:'#C9A84C',borderRadius:4},
        {label:'National Avg ROE (%)',data:roeData.map(r=>r.avg),backgroundColor:'rgba(107,114,128,.4)',borderRadius:4},
      ]
    },
    options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{font:{size:11}}}},scales:{x:{min:4,max:12,ticks:{callback:v=>v+'%',font:{size:10}}},y:{ticks:{font:{size:11}}}}}
  });
  // Rate case table
  const tb=document.getElementById('rateTbody');
  rateCases.forEach((r,i)=>{
    const ic=r.inc?(r.inc>5?'color:#E74C3C':'color:#C9A84C'):'color:#999';
    const tr=document.createElement('tr');
    tr.innerHTML=`<td class="fw7" style="color:${UTIL_COLORS[r.util]||'#333'}">${r.util}</td>
      <td>${r.year}</td>
      <td style="text-align:right;font-weight:600">${r.roe}%</td>
      <td style="text-align:right">${r.eq}%</td>
      <td style="text-align:right">${r.ltD}%</td>
      <td style="text-align:right;font-weight:700">$${r.revB}B</td>
      <td style="text-align:right;${ic}">${r.inc?'+'+r.inc+'%':'‚Äî'}</td>
      <td style="color:#E74C3C;font-size:11px">${r.dis}</td>
      <td style="color:#999;font-size:11px">${r.capex}</td>
      <td style="color:#999;font-size:11px">${r.src}</td>`;
    tb.appendChild(tr);
  });
  // Capex blocks
  const capexData=[
    {util:"PG&E",color:"#1F3864",areas:[{l:"Wildfire Hardening",p:38},{l:"Grid Modernization",p:22},{l:"Clean Energy/Storage",p:20},{l:"Distribution",p:15},{l:"Other",p:5}]},
    {util:"SCE",color:"#E74C3C",areas:[{l:"Distribution Infra (DIR)",p:35},{l:"Substation Rebuild",p:25},{l:"TE Infrastructure",p:18},{l:"Grid Monitoring",p:12},{l:"Other",p:10}]},
    {util:"PacifiCorp",color:"#F39C12",areas:[{l:"Wildfire Mitigation",p:30},{l:"Distribution Plan",p:28},{l:"Insurance/Fire Fund",p:20},{l:"Coal Transition",p:15},{l:"Other",p:7}]},
  ];
  const cg=document.getElementById('capexGrid');
  capexData.forEach(d=>{
    let rows=d.areas.map(a=>`<div class="capex-row">
      <div class="capex-label-row"><span>${a.l}</span><span style="font-weight:600">${a.p}%</span></div>
      <div class="capex-track"><div class="capex-fill" style="width:${a.p}%;background:${d.color}"></div></div>
    </div>`).join('');
    cg.innerHTML+=`<div class="capex-block"><div class="capex-title" style="color:${d.color}">${d.util}</div>${rows}</div>`;
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PAGE 5
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildPage5(){
  const ALERT_BG={Red:"#FEE2E2",Yellow:"#FEF9C3",Green:"#DCFCE7"};
  const ALERT_BORDER={Red:"#E74C3C",Yellow:"#F39C12",Green:"#27AE60"};
  // Risk cards
  const rc=document.getElementById('riskCards');
  riskScores.forEach(r=>{
    const bc=ALERT_BORDER[r.overall];
    const dims=[['Wildfire',r.wildfire],['RPS',r.rps],['Financial',r.financial],['Tx Gap',r.txGap],['Affordability',r.afford]];
    let dimHtml=dims.map(([k,v])=>{
      const dotColor=v>=7?'#E74C3C':v>=4?'#F39C12':'#27AE60';
      let dots='';for(let i=0;i<v;i++)dots+=`<span class="risk-dot" style="background:${dotColor}"></span>`;
      return `<div style="display:flex;justify-content:space-between;font-size:11px;margin-bottom:3px"><span style="color:#6B7280">${k}</span><div class="risk-dots">${dots}</div></div>`;
    }).join('');
    rc.innerHTML+=`<div class="risk-card" style="border-color:${bc}">
      <div class="risk-name" style="color:${UTIL_COLORS[r.util]||'#333'}">${r.util}</div>
      <div style="margin-top:4px"><span class="pill" style="background:${bc}">${r.overall}</span></div>
      <div style="margin-top:8px">${dimHtml}</div>
    </div>`;
  });
  // Radar chart
  charts.radar=new Chart(document.getElementById('radarChart'),{
    type:'radar',
    data:{
      labels:['Wildfire Risk','RPS Compliance','Financial Health','Tx Gap Risk','Rate Pressure'],
      datasets:[
        {label:'PG&E',data:[8,7,5,7,8],borderColor:'#1F3864',backgroundColor:'rgba(31,56,100,.15)',pointRadius:3},
        {label:'SCE',data:[6,8,7,6,6],borderColor:'#E74C3C',backgroundColor:'rgba(231,76,60,.15)',pointRadius:3},
        {label:'SDG&E',data:[4,6,8,5,5],borderColor:'#27AE60',backgroundColor:'rgba(39,174,96,.15)',pointRadius:3},
        {label:'PacifiCorp',data:[9,4,4,3,7],borderColor:'#F39C12',backgroundColor:'rgba(243,156,18,.15)',pointRadius:3},
      ]
    },
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{font:{size:11}}}},scales:{r:{min:0,max:10,ticks:{font:{size:9}},pointLabels:{font:{size:11}}}}}
  });
  // Opportunities
  const ol=document.getElementById('oppList');
  opportunities.forEach(op=>{
    const bg=ALERT_BG[op.flag],bc=ALERT_BORDER[op.flag];
    ol.innerHTML+=`<div class="opp-item" style="background:${bg};border-color:${bc}">
      <div class="opp-head">
        <span class="opp-title" style="color:${bc}">${op.title}</span>
        <span class="opp-cat" style="background:${bc}">${op.cat}</span>
      </div>
      <div class="opp-detail">${op.detail}</div>
    </div>`;
  });
  // Alerts
  const ag=document.getElementById('alertGrid');
  alerts.forEach(a=>{
    const icon=a.type==='Red'?'üî¥':a.type==='Yellow'?'üü°':'üü¢';
    ag.innerHTML+=`<div class="alert-item" style="background:${ALERT_BG[a.type]};border-color:${ALERT_BORDER[a.type]}">
      <div class="alert-title" style="color:${ALERT_BORDER[a.type]}">${icon} ${a.title}</div>
      <div class="alert-detail">${a.detail}</div>
    </div>`;
  });
  // Insights
  const ig=document.getElementById('insightGrid');
  insights.forEach(ins=>{
    ig.innerHTML+=`<div class="insight-item" style="border-color:${ins.color}">
      <div style="display:flex;align-items:center;margin-bottom:4px">
        <span class="insight-rank" style="background:${ins.color}">${ins.rank}</span>
        <span class="insight-label" style="color:${ins.color}">${ins.label}</span>
      </div>
      <p class="insight-text">${ins.text}</p>
    </div>`;
  });
  // KPIs
  const kl=document.getElementById('kpiList');
  [
    ['GW of new clean capacity procured vs. target (by utility, by year)','Procurement pipeline'],
    ['RPS compliance % vs. 2030/2035 mandated milestones','Regulatory compliance'],
    ['$/MWh average energy cost in WEIM 15-min market (quarterly)','Market efficiency'],
    ['Battery storage discharge capacity (MW) ‚Äî quarterly trend','Flexibility index'],
    ['Total authorized revenue requirements ($B) ‚Äî annual trend','Rate trajectory'],
    ['Transmission investment $ authorized vs. renewable GW pipeline','Grid readiness'],
    ['Curtailment volume (MWh) by region / cause (quarterly)','Oversupply indicator'],
    ['CRR market loss ($/quarter) as % of transmission revenue','Market design risk'],
  ].forEach(([kpi,cat],i)=>{
    kl.innerHTML+=`<div class="kpi-list-item">
      <span class="kpi-num">KPI ${i+1}</span>
      <div><div class="kpi-text">${kpi}</div><div class="kpi-cat">${cat}</div></div>
    </div>`;
  });
  // Data model
  const dm=document.getElementById('dmList');
  [
    ['Generation Mix ‚Üî RPS Dataset','Utility + Technology + Year ‚Üí links installed capacity to compliance trajectory'],
    ['RPS Dataset ‚Üî Policy Dataset','Net-zero year / GHG target ‚Üí maps legislative mandate to utility compliance gap'],
    ['Transmission ‚Üî Generation Mix','Region/Zone ‚Üí identifies where renewable capacity is constrained by transmission'],
    ['Rate Case ‚Üî IRP / Generation Mix','Utility + Year + CapEx ‚Üí correlates authorized spending with IRP procurement plans'],
    ['Policy ‚Üî All Datasets','Bill category ‚Üí flags which utilities face compliance obligations from each regulation'],
    ['Market Alerts ‚Üî Transmission + Generation','Congestion/curtailment indicators ‚Üí linked to geographic renewable vs. transmission gap'],
  ].forEach(([rel,desc])=>{
    dm.innerHTML+=`<div class="dm-item"><div class="dm-rel">${rel}</div><div class="dm-desc">${desc}</div></div>`;
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT ‚Äî build page 1 on load
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('load',()=>buildPage1());
</script>
</body>
</html>
